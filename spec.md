# ImageForLLM Specification

## Project Overview

ImageForLLM is a Python library designed to enhance image files with embedded metadata, making images more interpretable by Large Language Models (LLMs). The library provides tools to automatically incorporate relevant contextual information into images, enabling LLMs to better understand image content without requiring external description.

## Core Functionality

The library supports two primary use cases:

1. **Matplotlib Integration**: Automatically embeds source code and plot properties into images generated by matplotlib(More package is coming).
2. **AI-Generated Image Enhancement**: Adds metadata about AI image generation parameters (model, prompts, etc.) to images created by AI image generators.

## Use Case 1: Matplotlib Integration

### Features
- Automatic hooking of matplotlib's `savefig` function to embed metadata
- Extraction of plot properties (titles, axes labels, legends, etc.)
- Embedding of source code that generated the plot
- Tools for retrieving embedded information from images

### Implementation Details
- Uses PIL/Pillow for metadata embedding in PNG format
- Provides non-intrusive integration through function hooking
- Maintains compatibility with existing matplotlib workflows

### Workflow
1. Hook the matplotlib `savefig` function using `imageforllm.hook_image_save()`
2. Create plots normally with matplotlib
3. Save images with `plt.savefig()`, optionally providing source code via the `create_comment` parameter
4. Plot properties are automatically extracted and embedded
5. Unhook when done (optional)

## Use Case 2: AI-Generated Image Enhancement

### Features
- Embedding of AI model information used to generate images
- Storage of prompt text used to create the image
- Optional inclusion of generation parameters (seeds, styles, etc.)
- Standardized metadata format for AI image provenance

### Implementation Details
- Compatible with common AI image generation tools
- Consistent metadata schema for different AI models
- Support for extracting and viewing embedded AI generation metadata

### Workflow
1. Generate image using an AI model
2. Use ImageForLLM to embed generation information
3. Save the enhanced image file
4. LLMs can later extract and understand how the image was created

## Technical Specifications

### Metadata Schema
- `comment`: Source code or textual description
- `properties`: Plot properties for matplotlib images
- `ai_model`: Information about AI model used (for AI-generated images)
- `prompt`: Text prompt used for generation (for AI-generated images)
- `parameters`: Additional generation parameters (for AI-generated images)

### Supported Formats
- Primary support for PNG format
- Limited support for other formats based on metadata capabilities

### Performance Considerations
- Minimal overhead when saving images
- Metadata increases file size proportionally to content length

## API Reference

```python
# Core Functions
imageforllm.hook_image_save()  # Enable matplotlib integration
imageforllm.unhook_image_save()  # Disable matplotlib integration
imageforllm.get_image_info(image_path)  # Extract metadata from image

# AI Image Functions
imageforllm.add_ai_metadata(image_path, model, prompt, parameters=None)
imageforllm.extract_ai_metadata(image_path)

# Constants
imageforllm.METADATA_KEY_COMMENT  # Key for source code/comment in metadata
imageforllm.METADATA_KEY_PROPERTIES  # Key for plot properties in metadata
imageforllm.METADATA_KEY_AI_MODEL  # Key for AI model information
imageforllm.METADATA_KEY_PROMPT  # Key for generation prompt
imageforllm.METADATA_KEY_PARAMETERS  # Key for additional parameters
```

## Command-line Interface

The package provides command-line utilities for working with embedded metadata:

```bash
# Extract embedded information
python -m imageforllm.extract image.png [options]

# Add AI generation metadata
python -m imageforllm.ai_metadata image.png --model "stable-diffusion" --prompt "mountain landscape" [options]
```

## Limitations and Constraints

- Metadata embedding primarily supported for PNG format
- When saving to file-like objects, metadata embedding may not be supported
- The package cannot automatically determine the code that generated a plot without explicit provision
- File size increases with embedded metadata size

## Future Enhancements

- Support for additional image formats
- Integration with more AI image generation tools
- Enhanced metadata compression
- OCR capabilities for extracting information from existing images
- Web interface for metadata management 